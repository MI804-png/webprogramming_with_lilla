<div class="container py-5">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="display-5 fw-bold">
                    <i class="fas fa-arrow-left text-primary"></i> 
                    <a href="<%= basePath %>/messages" class="text-decoration-none">Messages</a> / Details
                </h1>
                <% 
                let statusClass = 'secondary';
                if (message.status === 'new') statusClass = 'success';
                else if (message.status === 'read') statusClass = 'primary';
                else if (message.status === 'replied') statusClass = 'info';
                %>
                <span class="badge bg-<%= statusClass %> fs-6"><%= message.status.toUpperCase() %></span>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-8">
            <div class="card card-custom shadow">
                <div class="card-header bg-light">
                    <h4 class="mb-0">
                        <i class="fas fa-envelope"></i> Message Details
                    </h4>
                </div>
                <div class="card-body p-4">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong><i class="fas fa-user"></i> From:</strong>
                            <p class="mb-0"><%= message.name %></p>
                        </div>
                        <div class="col-md-6">
                            <strong><i class="fas fa-envelope"></i> Email:</strong>
                            <p class="mb-0">
                                <a href="mailto:<%= message.email %>" class="text-decoration-none">
                                    <%= message.email %>
                                </a>
                            </p>
                        </div>
                    </div>
                    
                    <% if (message.subject) { %>
                    <div class="mb-3">
                        <strong><i class="fas fa-tag"></i> Subject:</strong>
                        <p class="mb-0"><%= message.subject %></p>
                    </div>
                    <% } %>
                    
                    <div class="mb-3">
                        <strong><i class="fas fa-calendar"></i> Received:</strong>
                        <p class="mb-0">
                            <%= new Date(message.created_at).toLocaleDateString() %> 
                            at <%= new Date(message.created_at).toLocaleTimeString() %>
                        </p>
                    </div>
                    
                    <hr>
                    
                    <div class="mb-4">
                        <strong><i class="fas fa-comment"></i> Message:</strong>
                        <div class="mt-2 p-3 bg-light rounded">
                            <p class="mb-0" style="white-space: pre-wrap;"><%= message.message %></p>
                        </div>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <a href="<%= basePath %>/messages" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Back to Messages
                        </a>
                        
                        <a href="mailto:<%= message.email %>?subject=Re: <%= message.subject || 'Your Inquiry' %>" class="btn btn-primary">
                            <i class="fas fa-reply"></i> Reply via Email
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <% if (locals.isAdmin) { %>
            <div class="card card-custom shadow mb-4">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">
                        <i class="fas fa-crown"></i> Admin Actions
                    </h5>
                </div>
                <div class="card-body">
                    <p class="text-muted">Update message status:</p>
                    
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-success btn-sm" onclick="updateStatus('new')">
                            <i class="fas fa-star"></i> Mark as New
                        </button>
                        <button class="btn btn-outline-primary btn-sm" onclick="updateStatus('read')">
                            <i class="fas fa-eye"></i> Mark as Read
                        </button>
                        <button class="btn btn-outline-info btn-sm" onclick="updateStatus('replied')">
                            <i class="fas fa-reply"></i> Mark as Replied
                        </button>
                    </div>
                </div>
            </div>
            <% } %>
            
            <div class="card card-custom shadow">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-info-circle"></i> Quick Actions
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="tel:+1234567890" class="btn btn-outline-success btn-sm">
                            <i class="fas fa-phone"></i> Call Customer
                        </a>
                        
                        <a href="<%= basePath %>/contact" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-plus"></i> New Message
                        </a>
                        
                        <button class="btn btn-outline-secondary btn-sm" onclick="window.print()">
                            <i class="fas fa-print"></i> Print Message
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<% if (locals.isAdmin) { %>
<script>
function updateStatus(status) {
    if (confirm(`Are you sure you want to mark this message as ${status}?`)) {
        fetch(`/messages/<%= message.id %>/status`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ status: status })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Failed to update status: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while updating the status.');
        });
    }
}
</script>
<% } %>